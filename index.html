<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>대전 중앙청과과 거래실적 대시보드</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.3/index.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }

        .card h3 {
            color: #4a5568;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: scale(1.05);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #718096;
            font-size: 0.9rem;
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin: 20px 0;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .control-group label {
            font-weight: 600;
            color: #4a5568;
            font-size: 0.9rem;
        }

        select, input {
            padding: 8px 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 0.9rem;
            transition: border-color 0.3s ease;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #667eea;
        }

        .data-table {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-top: 20px;
        }

        .table-header {
            background: #667eea;
            color: white;
            padding: 20px;
            font-size: 1.2rem;
            font-weight: 600;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px 15px;
            text-align: right;
            border-bottom: 1px solid #e2e8f0;
        }

        th {
            background: #f7fafc;
            font-weight: 600;
            color: #4a5568;
            text-align: center;
        }

        tr:hover {
            background: #f7fafc;
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: #718096;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
            
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            table {
                font-size: 0.8rem;
            }
            
            th, td {
                padding: 8px 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>중앙청 거래실적 대시보드</h1>
            <p>2021년 이후 거래 금액 및 물량 자료 분석</p>
        </div>

        <div class="controls">
            <div class="control-group">
                <label for="yearFilter">연도 필터</label>
                <select id="yearFilter">
                    <option value="all">전체</option>
                </select>
            </div>
            <div class="control-group">
                <label for="categoryFilter">카테고리</label>
                <select id="categoryFilter">
                    <option value="all">전체</option>
                    <option value="vegetable">채소</option>
                    <option value="fruit">과일</option>
                    <option value="total">합계</option>
                </select>
            </div>
            <div class="control-group">
                <label for="metricFilter">지표</label>
                <select id="metricFilter">
                    <option value="amount">물량 (kg)</option>
                    <option value="value">금액 (원)</option>
                    <option value="fee">수수료 (원)</option>
                </select>
            </div>
        </div>

        <div class="stats-grid" id="statsGrid">
            <div class="loading">
                <div class="spinner"></div>
                데이터를 불러오는 중...
            </div>
        </div>

        <div class="dashboard">
            <div class="card">
                <h3>월별 거래량 추이</h3>
                <div class="chart-container">
                    <canvas id="monthlyChart"></canvas>
                </div>
            </div>

            <div class="card">
                <h3>연도별 비교</h3>
                <div class="chart-container">
                    <canvas id="yearlyChart"></canvas>
                </div>
            </div>

            <div class="card">
                <h3>카테고리별 분포</h3>
                <div class="chart-container">
                    <canvas id="categoryChart"></canvas>
                </div>
            </div>

            <div class="card">
                <h3>지표별 상관관계</h3>
                <div class="chart-container">
                    <canvas id="correlationChart"></canvas>
                </div>
            </div>
        </div>

        <div class="data-table">
            <div class="table-header">상세 데이터</div>
            <div style="overflow-x: auto;">
                <table id="dataTable">
                    <thead>
                        <tr>
                            <th>날짜</th>
                            <th>채소 물량</th>
                            <th>채소 금액</th>
                            <th>채소 수수료</th>
                            <th>과일 물량</th>
                            <th>과일 금액</th>
                            <th>과일 수수료</th>
                            <th>총 물량</th>
                            <th>총 금액</th>
                            <th>총 수수료</th>
                        </tr>
                    </thead>
                    <tbody id="dataTableBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // 데이터 파싱 및 처리
        const rawData = `2021년 이후 중앙청과 거래실적 변동 현황(월별),,,,,,,,,
,채소,,,과일,,,합계,,,
,물량(kg),금액(원),수수료(원),물량(kg),금액(원),수수료(원),물량(kg),금액(원),수수료(원)
2021. 1.,"4,034,380 ","7,858,548,190 ","433,909,640 ","1,656,035 ","6,036,393,568 ","359,744,740 ","5,690,415 ","13,894,941,758 ","793,654,380 "
2021. 2.,"3,749,297 ","7,112,035,352 ","401,564,340 ","1,678,142 ","7,110,625,972 ","424,477,102 ","5,427,439 ","14,222,661,324 ","826,041,442 "
2021. 3.,"4,891,097 ","8,489,906,192 ","467,452,557 ","1,676,819 ","6,051,189,104 ","359,756,638 ","6,567,916 ","14,541,095,296 ","827,209,195 "
2021. 4.,"5,309,273 ","7,382,544,231 ","411,016,441 ","1,753,983 ","6,090,847,410 ","362,589,801 ","7,063,256 ","13,473,391,641 ","773,606,242 "
2021. 5.,"5,571,702 ","6,469,509,760 ","359,964,659 ","2,332,857 ","5,656,696,241 ","337,415,045 ","7,904,559 ","12,126,206,001 ","697,379,704 "
2021. 6.,"5,535,296 ","5,892,506,857 ","320,429,908 ","2,561,580 ","5,828,470,482 ","349,798,599 ","8,096,876 ","11,720,977,339 ","670,228,507 "
2021. 7.,"4,822,086 ","5,192,298,807 ","277,218,984 ","2,767,505 ","6,170,066,407 ","369,310,330 ","7,589,591 ","11,362,365,214 ","646,529,314 "
2021. 8.,"5,095,433 ","6,309,876,705 ","338,246,922 ","2,163,639 ","6,397,259,362 ","383,308,762 ","7,259,072 ","12,707,136,067 ","721,555,684 "
2021. 9.,"5,059,020 ","7,796,196,042 ","423,984,859 ","2,481,592 ","9,052,768,778 ","547,339,866 ","7,540,612 ","16,848,964,820 ","971,324,725 "
2021. 10.,"4,610,122 ","6,432,167,097 ","349,345,052 ","1,813,818 ","4,832,089,539 ","291,705,935 ","6,423,940 ","11,264,256,636 ","641,050,987 "
2021. 11.,"6,355,999 ","8,430,969,450 ","473,632,495 ","1,838,025 ","4,946,033,790 ","299,554,714 ","8,194,024 ","13,377,003,240 ","773,187,209 "
2021. 12.,"4,398,852 ","6,097,763,764 ","336,194,038 ","1,653,050 ","5,431,473,059 ","324,758,878 ","6,051,902 ","11,529,236,823 ","660,952,916 "
2022. 1.,"4,053,631 ","6,953,988,823 ","381,531,891 ","2,285,082 ","9,117,272,109 ","547,205,764 ","6,338,713 ","16,071,260,932 ","928,737,655 "
2022. 2.,"3,493,359 ","5,012,435,265 ","276,457,959 ","1,039,524 ","3,848,937,867 ","228,944,088 ","4,532,883 ","8,861,373,132 ","505,402,047 "
2022. 3.,"4,694,499 ","6,746,375,339 ","367,885,208 ","1,439,822 ","5,596,295,983 ","333,976,792 ","6,134,321 ","12,342,671,322 ","701,862,000 "
2022. 4.,"4,787,061 ","6,640,419,875 ","363,916,260 ","1,611,841 ","5,917,522,620 ","353,000,401 ","6,398,902 ","12,557,942,495 ","716,916,661 "
2022. 5.,"5,427,396 ","6,961,711,498 ","388,461,798 ","2,210,109 ","5,942,183,385 ","355,455,214 ","7,637,505 ","12,903,894,883 ","743,917,012 "
2022. 6.,"5,249,094 ","7,254,304,873 ","398,892,940 ","2,598,730 ","5,760,633,450 ","346,119,165 ","7,847,824 ","13,014,938,323 ","745,012,105 "
2022. 7.,"4,152,713 ","7,139,290,224 ","390,309,910 ","2,504,125 ","5,912,434,181 ","354,277,090 ","6,656,838 ","13,051,724,405 ","744,587,000 "
2022. 8.,"4,445,984 ","8,134,809,218 ","453,951,961 ","2,262,613 ","7,394,148,600 ","444,664,263 ","6,708,597 ","15,528,957,818 ","898,616,224 "
2022. 9.,"4,295,778 ","8,689,757,643 ","482,867,851 ","2,077,195 ","7,634,006,075 ","461,155,769 ","6,372,973 ","16,323,763,718 ","944,023,620 "
2022. 10.,"4,917,296 ","7,521,886,628 ","422,613,464 ","1,919,816 ","4,830,241,979 ","291,577,520 ","6,837,112 ","12,352,128,607 ","714,190,984 "
2022. 11.,"6,009,228 ","7,023,723,903 ","397,579,767 ","1,848,776 ","4,337,560,236 ","262,000,613 ","7,858,004 ","11,361,284,139 ","659,580,380 "
2022. 12.,"3,884,356 ","6,338,406,790 ","350,286,384 ","1,718,193 ","5,565,947,730 ","331,821,412 ","5,602,549 ","11,904,354,520 ","682,107,796 "
2023. 1.,"3,332,758 ","6,478,793,288 ","356,921,142 ","2,174,554 ","7,750,431,528 ","465,285,061 ","5,507,312 ","14,229,224,816 ","822,206,203 "
2023. 2.,"3,577,267 ","6,926,118,333 ","385,075,533 ","1,286,059 ","4,908,845,650 ","292,074,794 ","4,863,326 ","11,834,963,983 ","677,150,327 "
2023. 3.,"4,423,753 ","8,221,114,230 ","453,066,520 ","1,501,961 ","6,142,062,468 ","366,754,169 ","5,925,714 ","14,363,176,698 ","819,820,689 "
2023. 4.,"4,429,239 ","7,152,336,090 ","400,016,591 ","1,509,025 ","5,427,211,486 ","323,549,922 ","5,938,264 ","12,579,547,576 ","723,566,513 "
2023. 5.,"5,698,933 ","8,378,307,513 ","473,317,380 ","2,155,758 ","5,930,969,449 ","355,135,450 ","7,854,691 ","14,309,276,962 ","828,452,830 "
2023. 6.,"5,596,280 ","7,140,762,095 ","399,810,731 ","2,696,350 ","6,921,329,989 ","415,017,319 ","8,292,630 ","14,062,092,084 ","814,828,050 "
2023. 7.,"4,267,318 ","6,204,446,385 ","339,871,480 ","2,474,516 ","5,932,390,225 ","354,752,939 ","6,741,834 ","12,136,836,610 ","694,624,419 "
2023. 8.," 4,364,714 "," 7,417,263,397 "," 410,267,697 "," 1,809,969 "," 7,929,863,400 "," 474,993,371 ","6,174,683 ","15,347,126,797 ","885,261,068 "
2023. 9.," 4,909,131 "," 8,349,455,654 "," 464,501,839 "," 2,174,767 "," 10,039,103,360 "," 607,010,048 ","7,083,898 ","18,388,559,014 ","1,071,511,887 "
2023. 10.," 5,046,964 "," 7,768,429,438 "," 436,248,340 "," 1,763,908 "," 5,601,316,893 "," 336,736,791 ","6,810,872 ","13,369,746,331 ","772,985,131 "
2023. 11.," 5,883,993 "," 7,945,537,016 "," 452,911,925 "," 1,842,743 "," 5,844,353,500 "," 350,929,786 ","7,726,736 ","13,789,890,516 ","803,841,711 "
2023. 12.," 3,751,972 "," 6,657,622,976 "," 378,065,243 "," 1,554,813 "," 6,615,147,000 "," 394,715,273 ","5,306,785 ","13,272,769,976 ","772,780,516 "
2024. 1.," 3,703,066 "," 7,334,979,112 "," 412,147,254 "," 1,782,654 "," 10,073,356,500 "," 601,319,592 ","5,485,720 ","17,408,335,612 ","1,013,466,846 "
2024. 2.," 3,335,168 "," 7,338,402,214 "," 405,952,431 "," 1,189,968 "," 7,512,662,283 "," 447,881,902 ","4,525,136 ","14,851,064,497 ","853,834,333 "
2024. 3.," 3,995,114 "," 9,145,302,170 "," 508,780,124 "," 1,214,316 "," 6,559,611,700 "," 390,173,330 ","5,209,430 ","15,704,913,870 ","898,953,454 "
2024. 4.," 4,846,635 "," 9,011,948,551 "," 510,460,870 "," 1,360,687 "," 6,624,206,935 "," 394,176,751 ","6,207,322 ","15,636,155,486 ","904,637,621 "
2024. 5.," 5,964,111 "," 8,883,445,838 "," 506,786,298 "," 2,030,190 "," 6,929,520,735 "," 413,664,928 ","7,994,301 ","15,812,966,573 ","920,451,226 "
2024. 6.," 5,393,020 "," 6,289,113,865 "," 352,511,153 "," 2,805,632 "," 6,330,509,491 "," 379,479,481 ","8,198,652 ","12,619,623,356 ","731,990,634 "
2024. 7.," 4,412,396 "," 6,469,293,475 "," 361,179,888 "," 2,586,243 "," 5,881,850,700 "," 355,084,782 ","6,998,639 ","12,351,144,175 ","716,264,670 "
2024. 8.," 4,289,095 "," 7,933,336,206 "," 446,630,014 "," 2,233,418 "," 7,711,159,692 "," 463,047,485 ","6,522,513 ","15,644,495,898 ","909,677,499 "
2024. 9.," 4,223,295 "," 8,905,688,126 "," 503,328,542 "," 2,239,258 "," 9,472,988,475 "," 570,080,303 ","6,462,553 ","18,378,676,601 ","1,073,408,845 "
2024. 10.," 4,693,436 "," 8,730,870,254 "," 492,983,507 "," 1,673,283 "," 5,257,992,080 "," 312,616,728 ","6,366,719 ","13,988,862,334 ","805,600,235 "
2024. 11.," 6,487,581 "," 9,534,419,786 "," 554,062,114 "," 1,786,916 "," 5,312,287,675 "," 315,912,764 ","8,274,497 ","14,846,707,461 ","869,974,878 "
2024. 12.," 4,362,143 "," 7,538,381,787 "," 433,680,954 "," 1,882,226 "," 7,590,445,844 "," 451,071,404 ","6,244,369 ","15,128,827,631 ","884,752,358 "
2025. 1," 3,540,767 "," 7,406,716,420 "," 420,563,639 "," 2,156,793 "," 11,686,038,655 "," 698,263,689 ","5,697,560 ","19,092,755,075 ","1,118,827,328 "
2025. 2," 3,576,475 "," 7,465,169,716 "," 426,068,106 "," 1,136,404 "," 5,681,893,458 "," 337,585,889 ","4,712,879 ","13,147,063,174 ","763,653,995 "
2025. 3," 4,398,717 "," 8,940,143,225 "," 511,426,514 "," 1,459,274 "," 6,697,029,500 "," 399,451,155 ","5,857,991 ","15,637,172,725 ","910,877,669 "
2025. 4," 4,718,655 "," 7,964,873,170 "," 446,938,449 "," 1,661,094 "," 6,618,218,900 "," 394,572,601 ","6,379,749 ","14,583,092,070 ","841,511,050 "
2025. 5," 5,080,904 "," 7,371,024,343 "," 405,691,779 "," 2,104,339 "," 6,148,164,187 "," 366,438,701 ","7,185,243 ","13,519,188,530 ","772,130,480 "
2025. 6," 4,708,690 "," 5,895,319,380 "," 322,169,261 "," 2,558,760 "," 6,263,072,578 "," 374,319,958 ","7,267,450 ","12,158,391,958 ","696,489,219 "
2025. 7," 4,054,275 "," 6,192,238,026 "," 372,824,942 "," 2,537,879 "," 7,697,516,899 "," 536,400,961 ","6,592,154 ","13,889,754,925 ","909,225,903 "
2025. 8," 3,786,564 "," 6,609,853,433 "," 402,369,143 "," 2,063,520 "," 7,082,081,480 "," 494,363,909 ","5,850,084 ","13,691,934,913 ","896,733,052 "
2025. 9," 5,218,378 "," 8,352,681,098 "," 522,389,396 "," 2,438,502 "," 10,018,312,635 "," 699,196,868 ","7,656,880 ","18,370,993,733 ","1,221,586,264 "`;

        // 데이터 파싱 함수
        function parseData() {
            const lines = rawData.split('\n');
            const data = [];
            
            for (let i = 3; i < lines.length; i++) {
                const line = lines[i].trim();
                if (line && !line.startsWith(',')) {
                    const parts = line.split(',');
                    if (parts.length >= 10) {
                        const date = parts[0].replace(/"/g, '').trim();
                        const vegetableAmount = parseFloat(parts[1].replace(/[",]/g, '').trim()) || 0;
                        const vegetableValue = parseFloat(parts[2].replace(/[",]/g, '').trim()) || 0;
                        const vegetableFee = parseFloat(parts[3].replace(/[",]/g, '').trim()) || 0;
                        const fruitAmount = parseFloat(parts[4].replace(/[",]/g, '').trim()) || 0;
                        const fruitValue = parseFloat(parts[5].replace(/[",]/g, '').trim()) || 0;
                        const fruitFee = parseFloat(parts[6].replace(/[",]/g, '').trim()) || 0;
                        const totalAmount = parseFloat(parts[7].replace(/[",]/g, '').trim()) || 0;
                        const totalValue = parseFloat(parts[8].replace(/[",]/g, '').trim()) || 0;
                        const totalFee = parseFloat(parts[9].replace(/[",]/g, '').trim()) || 0;
                        
                        data.push({
                            date,
                            vegetable: { amount: vegetableAmount, value: vegetableValue, fee: vegetableFee },
                            fruit: { amount: fruitAmount, value: fruitValue, fee: fruitFee },
                            total: { amount: totalAmount, value: totalValue, fee: totalFee }
                        });
                    }
                }
            }
            return data;
        }

        // 숫자 포맷팅 함수
        function formatNumber(num, type = 'number') {
            if (type === 'currency') {
                return new Intl.NumberFormat('ko-KR').format(num) + '원';
            } else if (type === 'amount') {
                return new Intl.NumberFormat('ko-KR').format(num) + 'kg';
            } else {
                return new Intl.NumberFormat('ko-KR').format(num);
            }
        }

        // 통계 계산
        function calculateStats(data) {
            const totalAmount = data.reduce((sum, item) => sum + item.total.amount, 0);
            const totalValue = data.reduce((sum, item) => sum + item.total.value, 0);
            const totalFee = data.reduce((sum, item) => sum + item.total.fee, 0);
            const avgMonthlyValue = totalValue / data.length;
            
            return {
                totalAmount,
                totalValue,
                totalFee,
                avgMonthlyValue,
                dataCount: data.length
            };
        }

        // 차트 생성
        function createCharts(data) {
            // 월별 거래량 추이 차트
            const monthlyCtx = document.getElementById('monthlyChart').getContext('2d');
            new Chart(monthlyCtx, {
                type: 'line',
                data: {
                    labels: data.map(item => item.date),
                    datasets: [{
                        label: '채소 물량',
                        data: data.map(item => item.vegetable.amount),
                        borderColor: '#4CAF50',
                        backgroundColor: 'rgba(76, 175, 80, 0.1)',
                        tension: 0.4
                    }, {
                        label: '과일 물량',
                        data: data.map(item => item.fruit.amount),
                        borderColor: '#FF9800',
                        backgroundColor: 'rgba(255, 152, 0, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatNumber(value, 'amount');
                                }
                            }
                        }
                    }
                }
            });

            // 연도별 비교 차트
            const yearlyData = {};
            data.forEach(item => {
                const year = item.date.split('.')[0];
                if (!yearlyData[year]) {
                    yearlyData[year] = { amount: 0, value: 0, fee: 0 };
                }
                yearlyData[year].amount += item.total.amount;
                yearlyData[year].value += item.total.value;
                yearlyData[year].fee += item.total.fee;
            });

            const yearlyCtx = document.getElementById('yearlyChart').getContext('2d');
            new Chart(yearlyCtx, {
                type: 'bar',
                data: {
                    labels: Object.keys(yearlyData),
                    datasets: [{
                        label: '총 물량',
                        data: Object.values(yearlyData).map(item => item.amount),
                        backgroundColor: '#667eea',
                        borderColor: '#667eea',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatNumber(value, 'amount');
                                }
                            }
                        }
                    }
                }
            });

            // 카테고리별 분포 차트
            const categoryCtx = document.getElementById('categoryChart').getContext('2d');
            const totalVegetableAmount = data.reduce((sum, item) => sum + item.vegetable.amount, 0);
            const totalFruitAmount = data.reduce((sum, item) => sum + item.fruit.amount, 0);
            
            new Chart(categoryCtx, {
                type: 'doughnut',
                data: {
                    labels: ['채소', '과일'],
                    datasets: [{
                        data: [totalVegetableAmount, totalFruitAmount],
                        backgroundColor: ['#4CAF50', '#FF9800'],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });

            // 지표별 상관관계 차트
            const correlationCtx = document.getElementById('correlationChart').getContext('2d');
            new Chart(correlationCtx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: '물량 vs 금액',
                        data: data.map(item => ({
                            x: item.total.amount,
                            y: item.total.value
                        })),
                        backgroundColor: '#667eea',
                        borderColor: '#667eea'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: '물량 (kg)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return formatNumber(value, 'amount');
                                }
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: '금액 (원)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return formatNumber(value, 'currency');
                                }
                            }
                        }
                    }
                }
            });
        }

        // 테이블 생성
        function createTable(data) {
            const tbody = document.getElementById('dataTableBody');
            tbody.innerHTML = '';
            
            data.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.date}</td>
                    <td>${formatNumber(item.vegetable.amount, 'amount')}</td>
                    <td>${formatNumber(item.vegetable.value, 'currency')}</td>
                    <td>${formatNumber(item.vegetable.fee, 'currency')}</td>
                    <td>${formatNumber(item.fruit.amount, 'amount')}</td>
                    <td>${formatNumber(item.fruit.value, 'currency')}</td>
                    <td>${formatNumber(item.fruit.fee, 'currency')}</td>
                    <td>${formatNumber(item.total.amount, 'amount')}</td>
                    <td>${formatNumber(item.total.value, 'currency')}</td>
                    <td>${formatNumber(item.total.fee, 'currency')}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // 통계 카드 생성
        function createStatsCards(stats) {
            const statsGrid = document.getElementById('statsGrid');
            statsGrid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-value">${formatNumber(stats.totalAmount, 'amount')}</div>
                    <div class="stat-label">총 거래 물량</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${formatNumber(stats.totalValue, 'currency')}</div>
                    <div class="stat-label">총 거래 금액</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${formatNumber(stats.totalFee, 'currency')}</div>
                    <div class="stat-label">총 수수료</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${formatNumber(stats.avgMonthlyValue, 'currency')}</div>
                    <div class="stat-label">월평균 거래금액</div>
                </div>
            `;
        }

        // 필터 기능
        function applyFilters() {
            const yearFilter = document.getElementById('yearFilter').value;
            const categoryFilter = document.getElementById('categoryFilter').value;
            const metricFilter = document.getElementById('metricFilter').value;
            
            let filteredData = [...data];
            
            if (yearFilter !== 'all') {
                filteredData = filteredData.filter(item => item.date.startsWith(yearFilter));
            }
            
            // 필터링된 데이터로 차트 업데이트
            updateCharts(filteredData);
            createTable(filteredData);
        }

        // 차트 업데이트
        function updateCharts(data) {
            // 기존 차트 제거
            Chart.helpers.each(Chart.instances, function(instance) {
                instance.destroy();
            });
            
            // 새 차트 생성
            createCharts(data);
        }

        // 연도 필터 옵션 생성
        function populateYearFilter(data) {
            const yearFilter = document.getElementById('yearFilter');
            const years = [...new Set(data.map(item => item.date.split('.')[0]))].sort();
            
            years.forEach(year => {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                yearFilter.appendChild(option);
            });
        }

        // 초기화
        let data = [];
        
        document.addEventListener('DOMContentLoaded', function() {
            // 데이터 파싱
            data = parseData();
            
            // 통계 계산
            const stats = calculateStats(data);
            
            // UI 생성
            createStatsCards(stats);
            createCharts(data);
            createTable(data);
            populateYearFilter(data);
            
            // 이벤트 리스너
            document.getElementById('yearFilter').addEventListener('change', applyFilters);
            document.getElementById('categoryFilter').addEventListener('change', applyFilters);
            document.getElementById('metricFilter').addEventListener('change', applyFilters);
        });
    </script>
</body>
</html>
